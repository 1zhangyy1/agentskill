{
  "id": "80dc897b2c126da4",
  "slug": "opencode-swarm-plugin",
  "name": "Opencode Swarm Plugin",
  "description": "ðŸ Multi-agent swarm coordination for OpenCode with learning capabilities, beads integration, and Agent Mail",
  "author": "joelhooks",
  "authorAvatar": "https://avatars.githubusercontent.com/u/86834?v=4",
  "repoUrl": "https://github.com/joelhooks/opencode-swarm-plugin",
  "repoFullName": "joelhooks/opencode-swarm-plugin",
  "stars": 61,
  "forks": 0,
  "category": "ai-ml",
  "categories": [
    "ai-ml"
  ],
  "tags": [
    "ai-agents",
    "machine-learning",
    "multi-agent",
    "opencode",
    "swarm"
  ],
  "tier": 2,
  "status": "active",
  "createdAt": "2025-12-08T03:01:51Z",
  "updatedAt": "2025-12-14T02:19:40Z",
  "lastCommitAt": "2025-12-14T02:19:36Z",
  "source": "github-search",
  "collectedAt": "2025-12-14T03:47:39.899Z",
  "authorUrl": "https://github.com/joelhooks",
  "license": null,
  "readme": "# opencode-swarm-plugin\n\n[![npm version](https://img.shields.io/npm/v/opencode-swarm-plugin.svg)](https://www.npmjs.com/package/opencode-swarm-plugin)\n[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)\n\n```\n â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—    â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ–ˆâ•—\n â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ•‘\n â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘ â–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ•‘\n â•šâ•â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘\n â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â•šâ•â• â–ˆâ–ˆâ•‘\n â•šâ•â•â•â•â•â•â• â•šâ•â•â•â•šâ•â•â• â•šâ•â•  â•šâ•â•â•šâ•â•  â•šâ•â•â•šâ•â•     â•šâ•â•\n\n    \\ ` - ' /\n   - .(o o). -\n    (  >.<  )        Multi-agent coordination for OpenCode\n     /|   |\\         Break complex tasks into parallel subtasks,\n    (_|   |_)        spawn agents, coordinate via messaging.\n      bzzzz...       The plugin learns from outcomes.\n```\n\n## Install\n\n```bash\nnpm install -g opencode-swarm-plugin@latest\nswarm setup\n```\n\nThe setup wizard handles everything:\n\n```\nâ”Œ  opencode-swarm-plugin v0.16.0\nâ”‚\nâ—‡  Checking dependencies...\nâ”‚\nâ—†  OpenCode\nâ—†  Beads\nâ–²  CASS (optional)\nâ–²  UBS (optional)\nâ–²  semantic-memory (optional)\nâ”‚\nâ—‡  Setting up OpenCode integration...\nâ”‚\nâ—†  Plugin: ~/.config/opencode/plugin/swarm.ts\nâ—†  Command: ~/.config/opencode/command/swarm.md\nâ—†  Agent: ~/.config/opencode/agent/swarm-planner.md\nâ”‚\nâ””  Setup complete!\n```\n\nThen in your project:\n\n```bash\ncd your-project\nswarm init\n```\n\n## Migrating from MCP Agent Mail\n\nIf you were using the MCP-based Agent Mail (pre-v0.15), here's how to migrate:\n\n### What Changed\n\n- **Before:** Agent Mail required a separate MCP server running Go-based agent-mail\n- **After:** Agent Mail is now embedded using PGLite (no external dependencies)\n\n### Migration Steps\n\n1. **Update the plugin:**\n\n   ```bash\n   npm install -g opencode-swarm-plugin@latest\n   ```\n\n2. **Remove MCP configuration** (if present):\n   - Delete any `agent-mail` MCP server configuration from your OpenCode config\n   - The embedded version starts automatically\n\n3. **Data Migration:**\n   - Previous MCP data is NOT automatically migrated\n   - For most users, starting fresh is recommended (swarm state is ephemeral)\n   - If you need historical data, export from MCP before upgrading\n\n### Breaking Changes\n\n- `agentmail_*` tools now use embedded PGLite instead of MCP\n- No external server required\n- Slightly different error messages (more actionable)\n\n### Rollback\n\nIf you need to rollback:\n\n```bash\nnpm install -g opencode-swarm-plugin@0.14.x\n```\n\nAnd restore your MCP configuration.\n\n## CLI\n\n```\nswarm setup     Interactive installer - checks and installs all dependencies\nswarm doctor    Health check - shows status of all dependencies\nswarm init      Initialize beads in current project\nswarm config    Show paths to generated config files\nswarm version   Show version and banner\nswarm help      Show help\n```\n\n## Usage\n\nIn OpenCode:\n\n```\n/swarm \"Add user authentication with OAuth\"\n```\n\nOr invoke the planner directly:\n\n```\n@swarm-planner \"Refactor all components to use hooks\"\n```\n\n## Customization\n\nRun `swarm config` to see your config file paths:\n\n```\nðŸ”Œ Plugin loader\n   ~/.config/opencode/plugin/swarm.ts\n\nðŸ“œ /swarm command prompt\n   ~/.config/opencode/command/swarm.md\n\nðŸ¤– @swarm-planner agent\n   ~/.config/opencode/agent/swarm-planner.md\n```\n\n### /swarm Command\n\nThe `/swarm` command is defined in `~/.config/opencode/command/swarm.md`:\n\n```markdown\n---\ndescription: Decompose task into parallel subtasks and coordinate agents\n---\n\nYou are a swarm coordinator. Decompose the task into beads and spawn parallel agents.\n\n## Task\n\n$ARGUMENTS\n\n## Workflow\n\n1. **Initialize**: `swarmmail_init` with project_path and task_description\n2. **Decompose**: Use `swarm_select_strategy` then `swarm_plan_prompt`\n3. **Create beads**: `beads_create_epic` with subtasks and file assignments\n4. **Reserve files**: `swarmmail_reserve` for each subtask's files\n5. **Spawn agents**: Use Task tool with `swarm_spawn_subtask` prompts\n6. **Monitor**: Check `swarmmail_inbox` for progress\n7. **Complete**: `swarm_complete` when done, then `beads_sync` to push\n\n## Strategy Selection\n\n| Strategy      | Best For                | Keywords                              |\n| ------------- | ----------------------- | ------------------------------------- |\n| file-based    | Refactoring, migrations | refactor, migrate, rename, update all |\n| feature-based | New features            | add, implement, build, create         |\n| risk-based    | Bug fixes, security     | fix, bug, security, critical, urgent  |\n\nBegin decomposition now.\n```\n\n> **Note**: The `$ARGUMENTS` placeholder captures everything you type after `/swarm`. This is how your task description gets passed to the agent.\n\n### Agents\n\nThe setup wizard creates two agents with your chosen models:\n\n**@swarm-planner** (`~/.config/opencode/agent/swarm-planner.md`) - Coordinator that decomposes tasks:\n\n```yaml\n---\nname: swarm-planner\ndescription: Strategic task decomposition for swarm coordination\nmodel: anthropic/claude-sonnet-4-5 # Your chosen coordinator model\n---\n```\n\n**@swarm-worker** (`~/.config/opencode/agent/swarm-worker.md`) - Fast executor for subtasks:\n\n```yaml\n---\nname: swarm-worker\ndescription: Executes subtasks in a swarm - fast, focused, cost-effective\nmodel: anthropic/claude-haiku-4-5 # Your chosen worker model\n---\n```\n\n### Decomposition Rules\n\n- **2-7 subtasks** - Too few = not parallel, too many = coordination overhead\n- **No file overlap** - Each file appears in exactly one subtask\n- **Include tests** - Put test files with the code they test\n- **Order by dependency** - If B needs A's output, A comes first (lower index)\n\nEdit these files to customize behavior. Run `swarm setup` to regenerate defaults.\n\n## Skills\n\nSkills are reusable knowledge packages that agents can load on-demand. They contain domain expertise, workflows, and patterns that help agents perform specialized tasks.\n\n### Using Skills\n\n```bash\n# List available skills\nswarm tool skills_list\n\n# Read a skill's content\nswarm tool skills_read --json '{\"name\": \"debugging\"}'\n\n# Use a skill (get formatted for context injection)\nswarm tool skills_use --json '{\"name\": \"code-review\", \"context\": \"reviewing a PR\"}'\n```\n\nIn OpenCode, agents can use skills directly:\n\n```\nskills_list()                           # See what's available\nskills_use(name=\"debugging\")            # Load debugging patterns\nskills_use(name=\"swarm-coordination\")   # Load swarm workflow\n```\n\n### Bundled Skills\n\n| Skill                | Tags                 | Description                                                                          |\n| -------------------- | -------------------- | ------------------------------------------------------------------------------------ |\n| `cli-builder`        | cli, typescript, bun | Building TypeScript CLIs with Bun - argument parsing, subcommands, output formatting |\n| `learning-systems`   | learning, feedback   | Implicit feedback scoring, confidence decay, anti-pattern detection                  |\n| `mcp-tool-authoring` | mcp, tools           | Building MCP tools - schema definition, context passing, error handling              |\n| `skill-creator`      | meta, skills         | Guide for creating effective skills                                                  |\n| `swarm-coordination` | swarm, multi-agent   | Complete swarm playbook - strategies, coordinator patterns, failure recovery         |\n| `system-design`      | design, architecture | Building reusable systems - deep modules, complexity management, design red flags    |\n\n### Skill Locations\n\nSkills are loaded from three locations (in order):\n\n1. **Project skills**: `.opencode/skills/`, `.claude/skills/`, or `skills/`\n2. **Global skills**: `~/.config/opencode/skills/`\n3. **Bundled skills**: Included with the plugin\n\n### Creating Skills\n\n```bash\n# Initialize project skills directory\nswarm tool skills_init\n\n# Create a new skill\nswarm tool skills_create --json '{\"name\": \"my-skill\", \"description\": \"What it does\", \"tags\": [\"tag1\", \"tag2\"]}'\n```\n\nOr use the `skill-creator` skill for guidance:\n\n```\nskills_use(name=\"skill-creator\")\n```\n\nEach skill is a directory containing:\n\n```\nmy-skill/\n  SKILL.md           # Main content (required)\n  references/        # Optional supporting files\n    patterns.md\n    examples.md\n```\n\n### SKILL.md Format\n\n```markdown\n---\nname: my-skill\ndescription: Brief description for discovery\ntags:\n  - tag1\n  - tag2\n---\n\n# My Skill\n\n## When to Use\n\n- Trigger condition 1\n- Trigger condition 2\n\n## Patterns\n\n### Pattern Name\n\nDescription and examples...\n\n## Anti-Patterns\n\nWhat NOT to do...\n```\n\n## Dependencies\n\n| Dependency                                                                                             | Purpose                                                      | Required |\n| ------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------ | -------- |\n| [OpenCode](https://opencode.ai)                                                                        | Plugin host                                                  | Yes      |\n| [Beads](https://github.com/steveyegge/beads)                                                           | Git-backed issue tracking                                    | Yes      |\n| [CASS (Coding Agent Session Search)](https://github.com/Dicklesworthstone/coding_agent_session_search) | Historical context from past sessions                        | No       |\n| [UBS (Ultimate Bug Scanner)](https://github.com/Dicklesworthstone/ultimate_bug_scanner)                | Pre-completion bug scanning using AI-powered static analysis | No       |\n| [semantic-memory](https://github.com/joelhooks/semantic-memory)                                        | Learning persistence                                         | No       |\n| [Redis](https://redis.io)                                                                              | Rate limiting (SQLite fallback available)                    | No       |\n\nAll dependencies are checked and can be installed via `swarm setup`.\n\n### Installing Optional Dependencies\n\n**UBS (Ultimate Bug Scanner)** - Scans code for bugs before task completion:\n\n```bash\ncurl -fsSL \"https://raw.githubusercontent.com/Dicklesworthstone/ultimate_bug_scanner/master/install.sh\" | bash\n```\n\n**CASS (Coding Agent Session Search)** - Indexes and searches AI coding agent history:\n\n```bash\ncurl -fsSL https://raw.githubusercontent.com/Dicklesworthstone/coding_agent_session_search/main/install.sh | bash -s -- --easy-mode\n```\n\n> **Note:** Swarm Mail is now embedded (PGLite in-process) and works out of the box with no external dependencies. No Go or external servers required.\n\n## Tools Reference\n\n### Swarm\n\n| Tool                           | Description                                                               |\n| ------------------------------ | ------------------------------------------------------------------------- |\n| `swarm_init`                   | Initialize swarm session                                                  |\n| `swarm_select_strategy`        | Analyze task, recommend decomposition strategy (file/feature/risk-based)  |\n| `swarm_plan_prompt`            | Generate strategy-specific planning prompt with CASS history              |\n| `swarm_decompose`              | Generate decomposition prompt                                             |\n| `swarm_validate_decomposition` | Validate response, detect file conflicts                                  |\n| `swarm_spawn_subtask`          | Generate worker agent prompt with Swarm Mail/beads instructions           |\n| `swarm_status`                 | Get swarm progress by epic ID                                             |\n| `swarm_progress`               | Report subtask progress to coordinator                                    |\n| `swarm_complete`               | Complete subtask - runs UBS (Ultimate Bug Scanner), releases reservations |\n| `swarm_record_outcome`         | Record outcome for learning (duration, errors, retries)                   |\n\n### Beads\n\n| Tool                | Description                                    |\n| ------------------- | ---------------------------------------------- |\n| `beads_create`      | Create bead with type-safe validation          |\n| `beads_create_epic` | Create epic + subtasks atomically              |\n| `beads_query`       | Query beads with filters (status, type, ready) |\n| `beads_update`      | Update status/description/priority             |\n| `beads_close`       | Close bead with reason                         |\n| `beads_start`       | Mark bead as in-progress                       |\n| `beads_ready`       | Get next unblocked bead                        |\n| `beads_sync`        | Sync to git and push                           |\n| `beads_link_thread` | Link bead to Swarm Mail thread                 |\n\n### Swarm Mail (Embedded - Primary)\n\n| Tool                     | Description                                   |\n| ------------------------ | --------------------------------------------- |\n| `swarmmail_init`         | Initialize session, register agent            |\n| `swarmmail_send`         | Send message to agents                        |\n| `swarmmail_inbox`        | Fetch inbox (max 5, no bodies - context safe) |\n| `swarmmail_read_message` | Fetch single message body by ID               |\n| `swarmmail_reserve`      | Reserve file paths for exclusive editing      |\n| `swarmmail_release`      | Release file reservations                     |\n| `swarmmail_ack`          | Acknowledge message                           |\n| `swarmmail_health`       | Check embedded database health                |\n\n### Agent Mail (Deprecated - MCP-based)\n\n> **Note:** The MCP-based `agentmail_*` tools in `src/agent-mail.ts` are **deprecated** as of v0.14.0. They remain for backward compatibility but will be removed in v1.0.0.\n>\n> **Use `swarmmail_*` tools instead** - embedded PGLite implementation with no external server required. See [Migrating from MCP Agent Mail](#migrating-from-mcp-agent-mail) for migration guide.\n\n## Event-Sourced Architecture (Embedded)\n\n> **ðŸ™ Built on the shoulders of giants**\n>\n> The Swarm Mail system is deeply inspired by and builds upon [**MCP Agent Mail**](https://github.com/Dicklesworthstone/mcp_agent_mail) by [@Dicklesworthstone](https://github.com/Dicklesworthstone). The original MCP Agent Mail pioneered multi-agent coordination patterns including file reservations, thread-based messaging, and agent registration - concepts that form the foundation of this embedded implementation.\n>\n> If you need a production-ready, battle-tested solution with a full Go server, **use MCP Agent Mail directly**. This embedded version is an experimental alternative that trades the external server for in-process PGLite, optimized for single-machine development workflows.\n>\n> **Key contributions from MCP Agent Mail:**\n>\n> - File reservation protocol with conflict detection\n> - Agent registration and heartbeat patterns\n> - Thread-based message organization\n> - Importance levels and acknowledgment tracking\n>\n> Thank you to the MCP Agent Mail team for open-sourcing such a well-designed system.\n\n> **ðŸŽ¯ Quality Patterns from Superpowers**\n>\n> Several verification and debugging patterns in this plugin are inspired by [**Superpowers**](https://github.com/obra/superpowers) by [@obra](https://github.com/obra) (Jesse Vincent). Superpowers is a complete software development workflow for coding agents built on composable \"skills\".\n>\n> **Key patterns adopted:**\n>\n> - **Verification Gate** - The Gate Function (IDENTIFY â†’ RUN â†’ READ â†’ VERIFY â†’ CLAIM) ensures no completion claims without fresh verification evidence\n> - **3-Strike Architecture Rule** - After 3 failed fixes, question the architecture, not the bug\n> - **CSO (Claude Search Optimization)** - Skill descriptions that answer \"Should I read this right now?\"\n> - **Defense-in-Depth** - Validate at every layer data passes through\n>\n> Thank you Jesse for open-sourcing such a thoughtfully designed system.\n\nThe plugin includes an embedded event-sourced Swarm Mail implementation as an alternative to the external MCP server. This provides the same multi-agent coordination capabilities without requiring a separate server process.\n\n### Architecture Comparison\n\n**MCP-based (deprecated, external):**\n\n```\nplugin tools â†’ HTTP â†’ MCP Server (Go process) â†’ SQLite\n```\n\n**Event-sourced (embedded, current):**\n\n```\nplugin tools â†’ streams/agent-mail.ts â†’ streams/store.ts â†’ PGLite (in-process)\n                                             â†“\n                                    streams/projections.ts\n                                             â†“\n                              Materialized views (agents, messages, reservations)\n                                             â†“\n                                        Fast reads\n```\n\n### Architecture Flow\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                        Plugin Tools Layer                        â”‚\nâ”‚  (swarmmail_init, swarmmail_send, swarmmail_reserve, etc.)      â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                               â”‚\n                               â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                     streams/agent-mail.ts                        â”‚\nâ”‚                    (High-level API wrapper)                      â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                               â”‚\n                               â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                       streams/events.ts                          â”‚\nâ”‚        11 event types: agent_registered, message_sent,          â”‚\nâ”‚     file_reserved, message_read, message_acked, etc.            â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                               â”‚\n                               â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                        streams/store.ts                          â”‚\nâ”‚              Append-only event log (PGLite storage)             â”‚\nâ”‚       appendEvent() â€¢ readEvents() â€¢ replayEvents()             â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                               â”‚\n                               â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                     streams/projections.ts                       â”‚\nâ”‚                  Build materialized views from events            â”‚\nâ”‚    getAgents() â€¢ getInbox() â€¢ getActiveReservations()           â”‚\nâ”‚              checkConflicts() â€¢ threadStats()                    â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                              â”‚\n                              â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚              Materialized Tables (Derived State)                â”‚\nâ”‚     agents â€¢ messages â€¢ reservations â€¢ message_reads            â”‚\nâ”‚              (Rebuilt by replaying event log)                   â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### Module Descriptions\n\n| Module                     | Responsibility                                                                                     |\n| -------------------------- | -------------------------------------------------------------------------------------------------- |\n| **streams/events.ts**      | Zod schemas for 11 event types (agent_registered, message_sent, file_reserved, task_progress, etc) |\n| **streams/store.ts**       | Append-only event log with PGLite backend (appendEvent, readEvents, replayEvents)                  |\n| **streams/projections.ts** | Materialize views from events (getAgents, getInbox, checkConflicts, threadStats)                   |\n| **streams/agent-mail.ts**  | High-level API matching MCP interface (initAgent, sendAgentMessage, reserveAgentFiles)             |\n| **streams/debug.ts**       | Debugging utilities (debugEvents, debugAgent, debugMessage, inspectState)                          |\n\n### Key Benefits\n\n- **No external dependencies** - Runs in-process with PGLite (Postgres compiled to WASM)\n- **Full audit trail** - Every state change is an immutable event\n- **Crash recovery** - Rebuild state by replaying events from log\n- **Time-travel debugging** - Replay events up to any point in time\n- **Testability** - 127 tests passing across streams module\n- **Durable Streams protocol** - Inspired by Electric SQL's event sourcing patterns\n\n### Event Types\n\nThe system emits 11 event types tracked in `streams/events.ts`:\n\n| Event              | Triggered By                          |\n| ------------------ | ------------------------------------- |\n| `agent_registered` | Agent initialization                  |\n| `message_sent`     | Sending inter-agent message           |\n| `file_reserved`    | Reserving files for exclusive editing |\n| `file_released`    | Releasing file reservations           |\n| `message_read`     | Reading a message                     |\n| `message_acked`    | Acknowledging a message               |\n| `task_started`     | Starting work on a bead               |\n| `task_progress`    | Reporting progress update             |\n| `task_completed`   | Completing a bead                     |\n| `task_blocked`     | Marking a task as blocked             |\n| `agent_active`     | Agent heartbeat/keep-alive            |\n\n### Materialized Views\n\nProjections build these derived tables from the event log:\n\n| View            | Contains                                               |\n| --------------- | ------------------------------------------------------ |\n| `agents`        | Registered agents with metadata and last activity      |\n| `messages`      | All inter-agent messages with thread/importance        |\n| `reservations`  | Active file reservations with TTL and exclusivity flag |\n| `message_reads` | Read receipts for message tracking                     |\n\nState is always derived - delete the tables and replay events to rebuild.\n\n### Structured Output\n\n| Tool                             | Description                                           |\n| -------------------------------- | ----------------------------------------------------- |\n| `structured_extract_json`        | Extract JSON from markdown/text (multiple strategies) |\n| `structured_validate`            | Validate response against schema                      |\n| `structured_parse_evaluation`    | Parse self-evaluation response                        |\n| `structured_parse_decomposition` | Parse task decomposition response                     |\n| `structured_parse_bead_tree`     | Parse bead tree for epic creation                     |\n\n## Decomposition Strategies\n\n### File-Based\n\nBest for: refactoring, migrations, pattern changes\n\n- Group files by directory or type\n- Handle shared types/utilities first\n- Minimize cross-directory dependencies\n\n**Keywords**: refactor, migrate, rename, update all, replace\n\n### Feature-Based\n\nBest for: new features, adding functionality\n\n- Each subtask is a complete vertical slice\n- Start with data layer, then logic, then UI\n- Keep related components together\n\n**Keywords**: add, implement, build, create, feature\n\n### Risk-Based\n\nBest for: bug fixes, security issues\n\n- Write tests FIRST\n- Isolate risky changes\n- Audit similar code for same issue\n\n**Keywords**: fix, bug, security, critical, urgent\n\n## Learning\n\nThe plugin learns from outcomes:\n\n| Mechanism         | How It Works                                                |\n| ----------------- | ----------------------------------------------------------- |\n| Confidence decay  | Criteria weights fade unless revalidated (90-day half-life) |\n| Implicit feedback | Fast + success = helpful signal, slow + errors = harmful    |\n| Pattern maturity  | candidate â†’ established â†’ proven (or deprecated)            |\n| Anti-patterns     | Patterns with >60% failure rate auto-invert                 |\n\n## Context Preservation\n\nHard limits to prevent context exhaustion:\n\n| Constraint          | Default    | Reason                         |\n| ------------------- | ---------- | ------------------------------ |\n| Inbox limit         | 5 messages | Prevents token burn            |\n| Bodies excluded     | Always     | Fetch individually when needed |\n| Summarize preferred | Yes        | Key points, not raw dump       |\n\n## Rate Limiting\n\nClient-side limits (Redis primary, SQLite fallback):\n\n| Endpoint | Per Minute | Per Hour |\n| -------- | ---------- | -------- |\n| send     | 20         | 200      |\n| reserve  | 10         | 100      |\n| inbox    | 60         | 600      |\n\nConfigure via `OPENCODE_RATE_LIMIT_{ENDPOINT}_PER_MIN` env vars.\n\n## Development\n\n```bash\nbun install\nbun run typecheck\nbun test\nbun run build\n```\n\n## Troubleshooting\n\n### 1. First Step: Run Doctor\n\n```bash\nswarm doctor\n```\n\nThis checks all dependencies and shows their installation status.\n\n### 2. Common Issues\n\n| Issue                       | Cause                              | Solution                                          |\n| --------------------------- | ---------------------------------- | ------------------------------------------------- |\n| `beads: command not found`  | Beads CLI not installed            | `npm install -g @joelhooks/beads`                 |\n| `bd: command not found`     | Same as above                      | `npm install -g @joelhooks/beads`                 |\n| Verification Gate fails     | TypeScript errors or test failures | Fix errors shown, or use `skip_verification=true` |\n| File reservation conflict   | Another agent has the file         | Wait for release, or check `swarmmail_inbox`      |\n| `Mandate not found`         | ID doesn't exist                   | Use `mandate_list` to see available mandates      |\n| Swarm Mail connection error | Database not initialized           | Run `swarm setup` again                           |\n| `Agent not registered`      | Session not initialized            | Call `swarmmail_init` first                       |\n\n### 3. Getting Help\n\n- Run `swarm doctor` for dependency status\n- Check `swarmmail_health` for database status\n- File issues at: https://github.com/joelhooks/opencode-swarm-plugin/issues\n\n## License\n\nMIT\n",
  "installCommand": "git clone https://github.com/joelhooks/opencode-swarm-plugin ~/.claude/skills/opencode-swarm-plugin",
  "defaultBranch": "main",
  "hasMarketplaceJson": false,
  "skillPath": "README.md"
}