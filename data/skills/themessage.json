{
  "id": "230a6300d6de71c7",
  "slug": "themessage",
  "name": "TheMessage",
  "description": "《风声典藏版》桌游的服务端代码。客户端代码见：https://github.com/Death-alter/TheMessage",
  "author": "CuteReimu",
  "authorAvatar": "https://avatars.githubusercontent.com/u/77955264?v=4",
  "repoUrl": "https://github.com/CuteReimu/TheMessage",
  "repoFullName": "CuteReimu/TheMessage",
  "stars": 20,
  "forks": 16,
  "category": "coding",
  "categories": [
    "coding"
  ],
  "tags": [],
  "tier": 2,
  "status": "active",
  "createdAt": "2022-09-04T13:15:28Z",
  "updatedAt": "2025-12-16T12:02:09Z",
  "lastCommitAt": "2025-12-16T12:02:06Z",
  "source": "github-search",
  "collectedAt": "2025-12-23T03:42:35.585Z",
  "authorUrl": "https://github.com/CuteReimu",
  "license": "AGPL-3.0",
  "readme": "# FengSheng\n\n![](https://img.shields.io/github/languages/top/CuteReimu/TheMessage \"语言\")\n![](https://img.shields.io/badge/java%20version-17-informational \"Java 17\")\n[![](https://img.shields.io/github/actions/workflow/status/CuteReimu/TheMessage/build.yml?branch=kotlin)](https://github.com/CuteReimu/TheMessage/actions/workflows/build.yml \"代码分析\")\n[![](https://img.shields.io/github/issues/CuteReimu/TheMessage)](https://github.com/CuteReimu/TheMessage/issues \"issues\")\n[![](https://img.shields.io/github/contributors/CuteReimu/TheMessage)](https://github.com/CuteReimu/TheMessage/graphs/contributors \"贡献者\")\n[![](https://img.shields.io/github/license/CuteReimu/TheMessage)](https://github.com/CuteReimu/TheMessage/blob/kotlin/LICENSE \"许可协议\")\n\n**如果你非常想为本项目做贡献，但又不知道从哪里入手，可以尝试解决[这些问题](https://github.com/CuteReimu/TheMessage/contribute)**\n\n**你也可以[加入交流群](https://qm.qq.com/q/X7bBZ5qGiq)**\n\n**如果想要了解游戏规则，可以跳转到[fengsheng-doc](https://cutereimu.github.io/fengsheng-doc/)**\n\n## 声明\n\n- **本项目采用`AGPLv3`协议开源，任何直接、间接接触本项目的软件也要求使用`AGPLv3`协议开源**\n- **本项目仅用于学习和测试。不鼓励，不支持一切商业用途**\n- **本项目的作者由所有参与的开发者共同所有。请尊重各位开发者的劳动成果**\n- **在使用前，使用者应该对本项目有充分的了解。任何由于使用本项目提供的接口、文档等造成的不良影响和后果与任何开发者无关**\n- 由于本项目的特殊性，可能随时停止开发或删档\n- 本项目为开源项目，不接受任何的催单和索取行为\n\n## 运行\n\n```shell\n# 调试命令\n./gradlew run\n```\n\n> [!NOTE]\n> 执行`run`后卡在88%左右是正常现象，并且显示`> :run`是说明已经正在运行了，已经开启监听对应端口了。（为什么不显示100%？因为100%就是运行结束了！可以自行了解一下gradle。）\n\n> [!IMPORTANT]\n> `./gradlew run`一般用于本地调试，方便使用IDE工具进行断点调试，占用内存较大。\n> \n> 想要编译并部署请使用：\n> \n> ```shell\n> # 编译\n> ./gradlew build\n>\n> # 编译后的jar包在build/libs目录下\n> cd build/libs\n>\n> # 部署后自行用java运行\n> java -jar fengsheng-1.0-SNAPSHOT.jar\n> ```\n\n## 配置\n\n**游戏配置**\n\n第一次运行会在根目录下生成一个`application.properties`，如下：\n\n```properties\n# 文件服务器监听端口\nfile_server_port=9091\n# 服务端监听端口\nlisten_websocket_port=9091\n# 播放录像时最大间隔时间（秒）\nrule.record_max_interval=3\n# 游戏开始时摸牌数\nrule.hand_card_count_begin=3\n# 每回合摸牌数\nrule.hand_card_count_each_turn=3\n# 最大房间数\nroom_count=200\n# 默认的房间人数\nplayer.total_count=5\n# 默认的读条时间\nwaiting_second=20\n# 需要的客户端最低版本号\nclient_version=1\n# 客户端显示的录像列表中最多显示的对局数量\nrecord_list_size=20\n# 游戏公告内容\nnotice=公告\n# GM命令的端口，不受下面的gm.enable影响\ngm.listen_port=9092\n# 如果为true，下面的gm.debug_roles才会生效，同时还会禁用各种房间人数、机器人等限制\ngm.enable=false\n# 测试时强制设置的角色，按进入房间的顺序安排，需要gm.enable=true才会生效\ngm.debug_roles=22,26\n## 以下是推送相关的配置，通过mirai的http-api向qq推送消息\n# 是否开启推送\npush.enable_push=true\n# 机器人的qq号\npush.robot_qq=12345678\n# mirai的http-api的地址\npush.mirai_http_url=http\\://127.0.0.1\\:8080\n# mirai的http-api的verify_key\npush.mirai_verify_key=AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPp\n# 往哪个QQ群推送消息，可以是多个，用逗号分隔\npush.push_qq_groups=12345678\n```\n\n请注意，游戏运行时有可能也会自动更新这个文件，所以最好不要在运行时手动修改这个文件。\n\n**log4j配置**\n\n见 [src/main/resources/log4j2.xml](src/main/resources/log4j2.xml)\n\n## 关于GM命令\n\n直接GET请求`http://127.0.0.1:9092/xxxx?a=1&b=2`即可使用。目前支持的GM命令有：\n\n| 终结点                | 参数                               | 备注                                                                                     |\n|--------------------|----------------------------------|----------------------------------------------------------------------------------------|\n| /addcard           | player=0&card=1&count=1          | 其中player参数对应**服务器中的**玩家Id，card参数对应协议中的卡牌类型，count参数（非必填，默认1）为增加卡牌的个数                    |\n| /addmessagecard    | player=0&card=1&colors=0&count=1 | 其中player参数对应**服务器中的**玩家Id，card参数对应协议中的卡牌类型，colors参数对应协议中的卡牌颜色，count参数（非必填，默认1）为增加卡牌的个数 |\n| /addrobot          | count=1                          | 其中count参数对应想要增加机器人的个数，不填表示加满                                                           |\n| /getscore          | name=aaa                         | 其中name参数是想要获取分数的玩家名字                                                                   |\n| /getlasttime       | name=aaa                         | 获取最近一次游戏距离现在的时间，其中name参数是想要获取分数的玩家名字                                                   |\n| /ranklist          | 无                                | 获取排行榜                                                                                  |\n| /ranklist2         | 无                                | 获取文字版排行榜（前100名）                                                                        |\n| /resetpwd          | name=aaa                         | 其中name参数是想要重置密码的玩家名字（重置为空，玩家可以自行重新设置）                                                  |\n| /forbidrole        | name=aaa                         | 禁用角色，禁用的角色不会再出现在角色池里，其中name参数是想要禁用的中文角色名                                               |\n| /releaserole       | name=aaa                         | 启用角色，其中name参数是想要启用的中文角色名                                                               |\n| /setnotice         | notice=aaa                       | 热更新公告，其中notice字段就是要更新成什么                                                               |\n| /setversion        | version=1                        | 热更新客户端版本号，其中version字段就是要更新成多少                                                          |\n| /register          | name=aaa                         | 注册，其中name是用户名                                                                          |\n| /addnotify         | qq=12345678&when=0               | 开了喊我或者结束喊我的功能，qq是艾特的qq号，when为0是开了，1是结束（非必填，默认0）                                        |\n| /updatewaitsecond  | second=15                        | 修改默认出牌时间，其中second字段就是出牌时间（单位：秒），必须大于0                                                  |\n| /forceend          | 无                                | 强制结束所有游戏，用于卡住了的情况                                                                      |\n| /forbidplayer      | name=aaa&hour=72                 | 封号，其中name是用户名，hour是小时                                                                  |\n| /releaseplayer     | name=aaa                         | 解封，其中name是用户名                                                                          |\n| /winrate           | 无                                | 返回一张胜率统计的png图片                                                                         |\n| /winrate2          | 无                                | 返回json格式的胜率统计信息                                                                        |\n| /frequency         | 无                                | 返回json格式的游玩频率统计信息                                                                      |\n| /resetseason       | 无                                | 重置赛季，重置前请手动备份PlayerInfo.csv                                                            |\n| /addenergy         | name=aaa&energy=1                | 增加精力                                                                                   |\n| /addscore          | name=aaa&score=1                 | 增加分数                                                                                   |\n| /getallgames       | 无                                | 获取所有房间的状态                                                                              |\n| /removedeadplayers | 无                                | 删除所有僵尸号，执行前前请手动备份PlayerInfo.csv，请在没有游戏进行时执行                                            |\n\n## 把战绩推送到QQ群\n\n将配置文件`application.properties`中的`push.enable_push`设置为`true`，就可以开启将战绩推送到QQ群的功能。\n\n在使用推送功能之前，你应该首先自行搭建一个支持 [onebot-11](https://github.com/botuniverse/onebot-11) 接口的QQ机器人。例如：\n\n- [NapCat](https://github.com/NapNeko/NapCatQQ) 基于NTQQ的无头Bot框架\n- [OpenShamrock](https://github.com/whitechi73/OpenShamrock) 基于 Lsposed(Non-Riru) 实现 Kritor 标准的 QQ 机器人框架\n- [Lagrange](https://github.com/LagrangeDev/Lagrange.Core) 一个基于纯C#的NTQQ协议实现，源自Konata.Core\n- [LiteLoaderQQNT](https://github.com/LiteLoaderQQNT/LiteLoaderQQNT) QQNT 插件加载器\n- [Gensokyo](https://github.com/Hoshinonyaruko/Gensokyo) 基于qq官方api开发的符合onebot标准的golang实现，轻量、原生跨平台\n- [LLOneBot](https://github.com/LLOneBot/LLOneBot) LiteLoaderQQNT插件，使你的NTQQ支持OneBot11协议进行QQ机器人开发\n\n> [!IMPORTANT]\n> 本功能是基于onebot的正向http接口，因此你需要开启对应机器人项目的http监听。\n\n*纯人机局不会推送，至少要有2名真人玩家时才会推送。*\n\n## 开发相关\n\n### gradle镜像\n\n如果gradle下载太慢，可以修改`gradle/wrapper/gradle-wrapper.properties`中的`distributionUrl`：\n\n```diff\n- distributionUrl=https\\://services.gradle.org/distributions/gradle-8.7-bin.zip\n+ distributionUrl=https\\://mirrors.cloud.tencent.com/gradle/gradle-8.7-bin.zip\n```\n\n### maven镜像\n\n如果依赖库下载太慢，可以修改`build.gradle.kts`，自行使用下载较快的镜像\n\n```diff\nrepositories {\n+   maven(\"https://mirrors.cloud.tencent.com/nexus/repository/maven-public/\")\n    mavenCentral()\n}\n```\n\n### IDEA问题\n\n如遇IDEA提示“代码洞察功能不可用”，是因为role.proto生成的协议文件太大导致的，在帮助菜单中编辑一下IDEA的自定义属性`idea.properties`\n即可：\n\n```properties\n#---------------------------------------------------------------------\n# Maximum file size (kilobytes) IDE should provide code assistance for.\n# The larger file is the slower its editor works and higher overall system memory requests\n# if code assistance is enabled. Remove this property or set to very large number if your\n# code assistance for any files available regardless their size.\n#---------------------------------------------------------------------\nidea.max.intellisense.filesize=2500\n#---------------------------------------------------------------------\n# Maximum file size (kilobytes) IDE is able to open.\n#---------------------------------------------------------------------\nidea.max.content.load.filesize=20000\n```\n\n`idea.max.intellisense.filesize`表示IDEA的代码洞察功能支持缓存的单个文件大小。默认是2500，将它改大即可。若没有这个属性，自行添加并改大即可。\n\n### 中文乱码问题\n\n对于“排行”“胜率”这两个生成图片的功能，如遇Linux下中文乱码，请将字体文件放入`/usr/share/fonts`中，然后执行以下shell\n\n```shell\n# 刷新字体缓存\nfc-cache\n# 查看是否有宋体\nfc-list :lang=zh | grep 宋体\n```\n",
  "installCommand": "git clone https://github.com/CuteReimu/TheMessage ~/.claude/skills/themessage",
  "defaultBranch": "kotlin",
  "hasMarketplaceJson": false,
  "skillPath": "README.md"
}