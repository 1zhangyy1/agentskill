{
  "id": "ce00297fb4f9ce9d",
  "slug": "mcpspy",
  "name": "MCPSpy",
  "description": "MCP Monitoring with eBPF",
  "author": "alex-ilgayev",
  "authorAvatar": "https://avatars.githubusercontent.com/u/23579644?v=4",
  "repoUrl": "https://github.com/alex-ilgayev/MCPSpy",
  "repoFullName": "alex-ilgayev/MCPSpy",
  "stars": 481,
  "forks": 70,
  "category": "other",
  "categories": [
    "other"
  ],
  "tags": [
    "ai",
    "ai-security",
    "llm",
    "mcp",
    "monitoring",
    "security"
  ],
  "tier": 1,
  "status": "active",
  "createdAt": "2025-07-17T15:47:17Z",
  "updatedAt": "2025-12-18T04:37:00Z",
  "lastCommitAt": "2025-12-07T08:19:25Z",
  "source": "github-search",
  "collectedAt": "2025-12-21T03:45:55.693Z",
  "authorUrl": "https://github.com/alex-ilgayev",
  "license": "Apache-2.0",
  "readme": "# MCPSpy - MCP Monitoring with eBPF üïµÔ∏è‚ú®\n\n[![CI](https://github.com/alex-ilgayev/mcpspy/actions/workflows/ci.yml/badge.svg)](https://github.com/alex-ilgayev/mcpspy/actions/workflows/ci.yml)\n[![Go Version](https://img.shields.io/badge/go-1.24+-blue.svg)](https://golang.org)\n[![License](https://img.shields.io/badge/license-Apache%202.0-blue.svg)](LICENSE)\n\n<div align=\"center\">\n<pre>\n‚ñà‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ïó\n‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ïö‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïî‚ïù\n‚ñà‚ñà‚ïî‚ñà‚ñà‚ñà‚ñà‚ïî‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù ‚ïö‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù \n‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïù   ‚ïö‚ñà‚ñà‚ïî‚ïù  \n‚ñà‚ñà‚ïë ‚ïö‚ïê‚ïù ‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë        ‚ñà‚ñà‚ïë   \n‚ïö‚ïê‚ïù     ‚ïö‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïù     ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïù        ‚ïö‚ïê‚ïù   \n</pre>\n<b>MCPSpy - Real-time monitoring for Model Context Protocol communication using eBPF</b>\n</div>\n\n## Overview\n\nMCPSpy is a powerful command-line tool that leverages [eBPF (Extended Berkeley Packet Filter)](https://ebpf.io/) technology to monitor [Model Context Protocol (MCP)](https://modelcontextprotocol.io/) communication at the kernel level. It provides real-time visibility into JSON-RPC 2.0 messages exchanged between MCP clients and servers by hooking into low-level system calls.\n\nThe Model Context Protocol supports three transport protocols for communication:\n\n- **Stdio**: Communication over standard input/output streams\n- **Streamable HTTP**: Direct HTTP request/response communication with server-sent events\n- **SSE (Server-Sent Events)**: HTTP-based streaming communication (_Deprecated_)\n\n**MCPSpy supports monitoring of both Stdio and HTTP/HTTPS transports** (including Server-Sent Events), providing comprehensive coverage of MCP communication channels.\n\n![demo](./assets/demo.gif)\n\n## Why MCPSpy?\n\nThe Model Context Protocol is becoming the standard for AI tool integration, but understanding what's happening under the hood can be challenging. MCPSpy addresses this by providing:\n\n- **üîí Security Analysis**: Monitor what data is being transmitted, detect PII leakage, and audit tool executions\n- **üõ°Ô∏è Prompt Injection Detection**: Real-time detection of prompt injection and jailbreak attempts using ML models\n- **üêõ Debugging**: Troubleshoot MCP integrations by seeing the actual message flow\n- **üìä Performance Monitoring**: Track message patterns and identify bottlenecks\n- **üîç Compliance**: Ensure MCP communications meet regulatory requirements\n- **üéì Learning**: Understand how MCP works by observing real communications\n\n## Installation\n\n### Prerequisites\n\n- Linux kernel version 5.15 or later\n- Root privileges (required for eBPF)\n\n### Download Pre-built Binary (Auto-detect OS + Arch)\n\nDownload the latest release from the [release page](https://github.com/alex-ilgayev/mcpspy/releases):\n\n```bash\n# Set platform-aware binary name\nBIN=\"mcpspy-$(uname -s | tr '[:upper:]' '[:lower:]')-$(uname -m | sed -e 's/x86_64/amd64/' -e 's/aarch64/arm64/')\"\n\n# Download the correct binary\nwget \"https://github.com/alex-ilgayev/mcpspy/releases/latest/download/${BIN}\"\n\n# Make it executable and move to a directory in your PATH\nchmod +x \"${BIN}\"\nsudo mv \"${BIN}\" /usr/local/bin/mcpspy\n```\n\n> ‚úÖ Note: Currently supported platforms: linux-amd64, linux-arm64\n\n### Build from Source\n\n#### Install Dependencies\n\nFirst, install the required system dependencies:\n\n```bash\nsudo apt-get update\n# Install build essentials, eBPF dependencies\nsudo apt-get install -y clang clang-format llvm make libbpf-dev build-essential\n# Install Python 3 and pip (for e2e tests)\nsudo apt-get install -y python3 python3-pip python3-venv\n# Install docker and buildx (if not already installed)\nsudo apt-get install -y docker.io docker-buildx\n```\n\n#### Install Go\n\nMCPSpy requires Go 1.24 or later. Install Go using one of these methods:\n\nOption 1: Install from the official Go website (Recommended)\n\n```bash\n# Download and install Go 1.24.1 (adjust version as needed)\nwget https://go.dev/dl/go1.24.1.linux-amd64.tar.gz\nsudo rm -rf /usr/local/go\nsudo tar -C /usr/local -xzf go1.24.1.linux-amd64.tar.gz\n\n# Add Go to PATH (add this to your ~/.bashrc or ~/.profile for persistence)\nexport PATH=$PATH:/usr/local/go/bin\n```\n\nOption 2: Install via snap\n\n```bash\nsudo snap install go --classic\n```\n\n#### Build MCPSpy\n\nClone the repository and build MCPSpy:\n\n```bash\n# Clone the repository\ngit clone https://github.com/alex-ilgayev/mcpspy.git\ncd mcpspy\n\n# Build the project\nmake all\n```\n\n### Docker\n\n```bash\n# Build Docker image\nmake image\n# Or pull the latest image\ndocker pull ghcr.io/alex-ilgayev/mcpspy:latest\n# Or pull a specific image release\ndocker pull ghcr.io/alex-ilgayev/mcpspy:v0.1.0\n\n# Run the container\ndocker run --rm -it --privileged ghcr.io/alex-ilgayev/mcpspy:latest\n```\n\n### Kubernetes\n\nMCPSpy can be deployed in Kubernetes clusters to monitor MCP traffic from AI/LLM services like LangFlow, LangGraph, and other applications that use the Model Context Protocol.\n\n```bash\n# Deploy MCPSpy as a DaemonSet\nkubectl apply -f https://raw.githubusercontent.com/alex-ilgayev/mcpspy/main/deploy/kubernetes/mcpspy.yaml\n```\n\n#### Real-World Use Cases in Kubernetes\n\n1. **Monitoring LangFlow/LangGraph Deployments**\n\n   - Observe MCP traffic between LangFlow/LangGraph and AI services\n   - Debug integration issues in complex AI workflows\n   - Audit AI interactions for security and compliance\n\n2. **AI Service Monitoring**\n\n   - Track interactions with both remote and local MCP servers\n   - Identify performance bottlenecks in AI service calls\n   - Detect potential data leakage in AI communications\n\n3. **Development and Testing**\n   - Test MCP implementations in containerized environments\n   - Validate AI service integrations before production deployment\n   - Ensure consistent behavior across different environments\n\nFor detailed instructions and real-world examples of monitoring AI services in Kubernetes, see the [Kubernetes Usage Guide](docs/kubernetes-usage.md).\n\n## Usage\n\n### Basic Usage\n\n```bash\n# Start monitoring MCP communication (TUI mode is default)\nsudo mcpspy\n\n# Start monitoring with static console output (disable TUI)\nsudo mcpspy --tui=false\n\n# Start monitoring and save output to JSONL file\nsudo mcpspy -o output.jsonl\n\n# Stop monitoring with Ctrl+C (or 'q' in TUI mode)\n```\n\n### Prompt Injection Detection\n\nMCPSpy includes optional real-time prompt injection detection using HuggingFace's Inference API. When enabled, it analyzes MCP tool calls for potential injection attacks and jailbreak attempts.\n\n**Detection coverage:**\n\n1. **Request-based injection**: Detects malicious prompts in tool call arguments\n2. **Response-based injection**: Detects malicious content in tool responses that could manipulate the agent\n\n```bash\n# Enable security scanning with HuggingFace token\nsudo mcpspy --security --hf-token=hf_xxxxx\n\n# Use a custom detection model\nsudo mcpspy --security --hf-token=hf_xxxxx --security-model=protectai/deberta-v3-base-prompt-injection-v2\n\n# Adjust detection threshold (default: 0.5)\nsudo mcpspy --security --hf-token=hf_xxxxx --security-threshold=0.7\n\n# Run analysis synchronously (blocks until analysis completes)\nsudo mcpspy --security --hf-token=hf_xxxxx --security-async=false\n```\n\n**Security CLI Flags:**\n\n| Flag                   | Description                                               | Default                               |\n| ---------------------- | --------------------------------------------------------- | ------------------------------------- |\n| `--security`           | Enable prompt injection detection                         | `false`                               |\n| `--hf-token`           | HuggingFace API token (required when security is enabled) | -                                     |\n| `--security-model`     | HuggingFace model for detection                           | `meta-llama/Llama-Prompt-Guard-2-86M` |\n| `--security-threshold` | Detection threshold (0.0-1.0)                             | `0.5`                                 |\n| `--security-async`     | Run analysis asynchronously                               | `true`                                |\n\n**Supported Models:**\n\n- `meta-llama/Llama-Prompt-Guard-2-86M` (default, requires HF license acceptance)\n- `protectai/deberta-v3-base-prompt-injection-v2` (publicly accessible)\n\nWhen a potential injection is detected, MCPSpy displays a security alert with risk level (low/medium/high/critical), category, and the analyzed content.\n\n### Output Format\n\n#### TUI Mode (Default)\n\nMCPSpy runs in interactive Terminal UI mode by default. The TUI provides:\n\n- Interactive table view with scrolling\n- Detailed message inspection (press Enter)\n- Filtering by transport, type, and actor\n- Multiple density modes for different screen sizes\n- Real-time statistics\n\n#### Static Console Output\n\nWhen running with `--tui=false`:\n\n```\n\n12:34:56.789 python[12345] ‚Üí python[12346] REQ tools/call (get_weather) Execute a tool\n12:34:56.890 python[12346] ‚Üí python[12345] RESP OK\n\n```\n\n#### JSONL Output\n\n**Stdio Transport - Request:**\n\n```json\n{\n  \"timestamp\": \"2024-01-15T12:34:56.789Z\",\n  \"transport_type\": \"stdio\",\n  \"stdio_transport\": {\n    \"from_pid\": 12345,\n    \"from_comm\": \"python\",\n    \"to_pid\": 12346,\n    \"to_comm\": \"python\"\n  },\n  \"type\": \"request\",\n  \"id\": 7,\n  \"method\": \"tools/call\",\n  \"params\": {\n    \"name\": \"get_weather\",\n    \"arguments\": { \"city\": \"New York\" }\n  },\n  \"error\": {},\n  \"raw\": \"{...}\"\n}\n```\n\n**Stdio Transport - Response:**\n\n```json\n{\n  \"timestamp\": \"2024-01-15T12:34:56.890Z\",\n  \"transport_type\": \"stdio\",\n  \"stdio_transport\": {\n    \"from_pid\": 12346,\n    \"from_comm\": \"python\",\n    \"to_pid\": 12345,\n    \"to_comm\": \"python\"\n  },\n  \"type\": \"response\",\n  \"id\": 7,\n  \"result\": {\n    \"content\": [\n      {\n        \"type\": \"text\",\n        \"text\": \"Weather in New York: 20¬∞C\"\n      }\n    ],\n    \"isError\": false\n  },\n  \"error\": {},\n  \"request\": {\n    \"type\": \"request\",\n    \"id\": 7,\n    \"method\": \"tools/call\",\n    \"params\": {\n      \"name\": \"get_weather\",\n      \"arguments\": { \"city\": \"New York\" }\n    },\n    \"error\": {}\n  },\n  \"raw\": \"{...}\"\n}\n```\n\n**HTTP/HTTPS Transport - Request:**\n\n```json\n{\n  \"timestamp\": \"2024-01-15T12:34:56.789Z\",\n  \"transport_type\": \"http\",\n  \"http_transport\": {\n    \"pid\": 47837,\n    \"comm\": \"python\",\n    \"host\": \"127.0.0.1:12345\",\n    \"is_request\": true\n  },\n  \"type\": \"request\",\n  \"id\": 7,\n  \"method\": \"tools/call\",\n  \"params\": {\n    \"name\": \"get_weather\",\n    \"arguments\": { \"city\": \"New York\" }\n  },\n  \"error\": {},\n  \"raw\": \"{...}\"\n}\n```\n\n**HTTP/HTTPS Transport - Response:**\n\n```json\n{\n  \"timestamp\": \"2024-01-15T12:34:56.890Z\",\n  \"transport_type\": \"http\",\n  \"http_transport\": {\n    \"pid\": 47837,\n    \"comm\": \"python\",\n    \"host\": \"127.0.0.1:12345\"\n  },\n  \"type\": \"response\",\n  \"id\": 7,\n  \"result\": {\n    \"content\": [\n      {\n        \"type\": \"text\",\n        \"text\": \"Weather in New York: 20¬∞C\"\n      }\n    ],\n    \"isError\": false\n  },\n  \"error\": {},\n  \"request\": {\n    \"type\": \"request\",\n    \"id\": 7,\n    \"method\": \"tools/call\",\n    \"params\": {\n      \"name\": \"get_weather\",\n      \"arguments\": { \"city\": \"New York\" }\n    },\n    \"error\": {}\n  },\n  \"raw\": \"{...}\"\n}\n```\n\n## Architecture\n\nMCPSpy uses an event-driven architecture with a publish-subscribe pattern to decouple components and enable extensibility. The system consists of several components that communicate through a central event bus:\n\n### 1. Event Bus (`pkg/bus/`)\n\n- Central communication hub using publish-subscribe pattern\n- Enables asynchronous event processing\n- Using `github.com/asaskevich/EventBus` library\n\n### 2. eBPF Program (`bpf/`)\n\n- Hooks into `vfs_read` and `vfs_write` kernel functions for stdio transport\n- Hooks into TLS library functions (`SSL_read`, `SSL_write`) for HTTP/HTTPS transport\n- Filters potential MCP traffic by detecting JSON patterns\n- Sends events to userspace via ring buffer\n- Minimal performance impact with early filtering\n\n### 3. eBPF Loader (`pkg/ebpf/`)\n\n- Manages the lifecycle of eBPF programs and resources\n- Loads pre-compiled eBPF objects into the kernel using cilium/ebpf library\n- Converts raw binary events from kernel space into structured Go data types\n- Publishes events to the event bus for downstream processing\n\n### 4. HTTP Session Manager (`pkg/http/`)\n\n- Subscribes to TLS-related events from the event bus\n- Manages HTTP/HTTPS sessions and correlates request/response pairs\n- Handles TLS payload interception and parsing\n- Supports chunked transfer encoding and Server-Sent Events (SSE)\n- Reconstructs complete HTTP messages from fragmented TLS data\n- Publishes reconstructed HTTP bodies to the event bus for MCP parsing\n\n### 5. MCP Protocol Parser (`pkg/mcp/`)\n\n- Subscribes to data events from the event bus (stdio and HTTP TLS payloads)\n- Validates JSON-RPC 2.0 message format\n- Parses MCP-specific methods and parameters\n- Correlates read operations and write operations into a single MCP message (relevant for stdio transport)\n- Supports both stdio and HTTP/HTTPS transports (including SSE)\n- Publishes parsed MCP messages to the event bus\n\n### 6. Output Handlers (`pkg/output/`)\n\n- Subscribe to MCP message events from the event bus\n- Console display with colored, formatted output\n- JSONL output for programmatic analysis\n- Real-time statistics tracking\n\n### 7. Event Logger (`pkg/eventlogger/`)\n\n- Subscribes to all events on the event bus for debugging\n- Provides detailed logging of event flow through the system\n- Configurable log levels for different event types\n\n### 8. Security Analyzer (`pkg/security/`)\n\n- Optional component for real-time prompt injection detection\n- Subscribes to MCP message events from the event bus\n- Analyzes high-risk methods (`tools/call`, `resources/read`, `prompts/get`)\n- Uses HuggingFace Inference API with configurable ML models\n- Publishes security alerts when injections are detected\n- Supports async and sync analysis modes\n\n## Development\n\n### Building\n\n```bash\n# Generate eBPF bindings and build\nmake all\n\n# Build Docker image\nmake image\n```\n\n### Testing\n\nMCPSpy includes comprehensive end-to-end tests that simulate real MCP communication across different transports:\n\n```bash\n# (Optional) Set up test environment\nmake test-e2e-setup\n\n# Run all tests (requires root privileges)\nmake test-e2e\n\n# Run individual transport tests\nmake test-e2e-stdio   # Test stdio transport\nmake test-e2e-https   # Test HTTP/HTTPS transport\n```\n\nThe test suite includes:\n\n- MCP server and client simulators for both stdio and HTTP transports\n- Message validation against expected outputs\n- Multiple message type coverage\n- SSL/TLS encrypted HTTP communication testing\n\n## Limitations\n\n- **FS Events Buffer Size**: Limited to 16KB per message. This means MCP messages with **buffer size** greater than 16KB will be missed / ignored.\n- **FS Events Constructed of Multiple Messages**: MCPSpy currently does not support reconstructing MCP messages that are split across multiple `read` or `write` syscalls. This means that if an MCP message is larger than the buffer size used in a single syscall, it may be missed or ignored.\n- **Inode Collision for Stdio Transport**: Inode numbers are only unique within a filesystem. If monitoring processes across multiple filesystems or mount namespaces, inode collisions are theoretically possible but rare in practice for pipe-based stdio communication.\n- **Platform**: Linux only (kernel 5.15+).\n\n## Contributing\n\nWe welcome contributions! Feel free to open an issue or a pull request.\n\n## License\n\n- **User-mode code** (Mainly Go): Apache 2.0 (see [LICENSE](LICENSE))\n- **eBPF C programs** (`bpf/*`): GPL-2.0-only (see [LICENSE-BPF](LICENSE-BPF))\n\n---\n\n<div align=\"center\">\nMade with ‚ù§Ô∏è by Alex Ilgayev\n</div>\n",
  "installCommand": "git clone https://github.com/alex-ilgayev/MCPSpy ~/.claude/skills/mcpspy",
  "defaultBranch": "main",
  "hasMarketplaceJson": false,
  "skillPath": "README.md"
}